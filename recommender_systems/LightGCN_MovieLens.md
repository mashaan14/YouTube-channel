# Movie Recommendations using LightGCN

<head>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"></script>
</head>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" src="https://www.youtube.com/embed/G6c6zk0RhRM" frameborder="0" allowfullscreen></iframe>
</div>

## Acknowledgement

I got most of the code in this post by prompting Grok, so thanks to the developers who made their code available. I compared the code generated by Grok with the official repository of [LightGCN](https://github.com/gusye1234/LightGCN-PyTorch/tree/master) and notes posted by [CS224W: Machine Learning with Graphs](http://cs224w.Stanford.edu), checking for accuracy and consistency.

## References

```bibtex
@inproceedings{kipf2016semi,
  title={Semi-supervised classification with graph convolutional networks},
  author={Kipf, Thomas N and Welling, Max},
  booktitle={International Conference on Learning Representations},
  year={2017}
}
```
```bibtex
@inproceedings{wu2019simplifying,
  title={Simplifying Graph Convolutional Networks},
  author={Wu,Felix and Souza Jr,Amauri and Zhang,Tao and Goodman,Christopher and Meek,Christopher},
  booktitle={International Conference on Machine Learning},
  pages={6861--6871},
  year={2019}
}
```
```bibtex
@inproceedings{wang2019neural,
  title={Neural graph collaborative filtering},
  author={Wang, Xiang and Liu, Xiangnan and Zhao, Xiang and Meng, Lican and Chen, Weinan and Zhang, Min and Xie, Yue and Li, Shaoping},
  booktitle={Proceedings of the 42nd International ACM SIGIR Conference on Research and Development in Information Retrieval},
  pages={165--174},
  year={2019}
}
```
```bibtex
@inproceedings{he2020lightgcn,
  title={LightGCN: Simplifying and Powering Graph Convolution Network for Recommendation},
  author={He, Xiangnan and Deng, Kuan and Xiang, Zhengyu and Wang, Yan and Liu, Yongdong and Chua, Tat-Seng},
  booktitle={Proceedings of the 43rd International ACM SIGIR conference on research and development in Information Retrieval},
  pages={639--648},
  year={2020}
}
```

![mermaid-diagram-2025-03-09-173910](https://github.com/user-attachments/assets/7f6f1993-1cfb-496a-b02a-2a9cde4af295)

## Graph Convolutional Networks (GCNs)

![001](https://github.com/user-attachments/assets/af9feeb2-b061-4905-8314-5749a53a2a81)

## Bipartite graph

_A bipartite graph is a graph whose vertices can be separated into two sets $X$ and $Y$ in such a way that every edge in the graph has one end point in each set_ (Marcus, 2020, "Graph Theory: A Problem Oriented Approach", p. 45). To avoid confusion, we will rename the two sets in our bipartite graph to users $u$ and items $i$. 

![Screenshot 2025-03-10 at 11 17 37 AM](https://github.com/user-attachments/assets/39696c73-2407-4700-b35a-6a0c5e313f75)

> source: [CS224W: Machine Learning with Graphs](http://cs224w.Stanford.edu)

---

Here's the structure of the adjacency matrix for a bipartite graph.

![Screenshot 2025-03-10 at 11 18 25 AM](https://github.com/user-attachments/assets/a42abebd-952f-42e7-86ce-7c03a8891925)


> source: [CS224W: Machine Learning with Graphs](http://cs224w.Stanford.edu)

## Recommender systems

GCN and simplified GCN papers use $H$ for embeddings, but NGCF and LightGCN use $E$. Although they represent the same thing, $E$ can be confusing because it's also used for the set of edges.

![002](https://github.com/user-attachments/assets/e6b8ac00-0fa8-44e9-926d-be19fb454424)

![003](https://github.com/user-attachments/assets/cde89b51-e98b-4003-bcbc-2bdfb2e3d69e)

## Tensor shapes during training

![004](https://github.com/user-attachments/assets/57930b5f-7c6c-4189-9593-52e4f10930f8)

![005](https://github.com/user-attachments/assets/9d0dc691-3361-4019-a013-238235c81a2a)

![006](https://github.com/user-attachments/assets/ebffe2d2-c2ed-4f5e-b5a6-d31c39607b84)

## MovieLens 100K Dataset

| File Name    | Description                                           |
| :--- | :---- | 
| u.data       | This is the core file. It contains ratings data: user ID, movie ID, rating, timestamp    |
| u.genre      | List of movie genres                                  |
| u.info       | Summary statistics of the dataset                     |
| u.item       | Movie information: movie ID, title, release date, genres |
| u.occupation | List of user occupations                              |
| u.user       | User information: user ID, age, gender, occupation, zip code |
| u1.base      | Training set for fold 1 of 5-fold cross-validation    |
| u1.test      | Test set for fold 1 of 5-fold cross-validation        |
| u2.base      | Training set for fold 2 of 5-fold cross-validation    |
| u2.test      | Test set for fold 2 of 5-fold cross-validation        |
| u3.base      | Training set for fold 3 of 5-fold cross-validation    |
| u3.test      | Test set for fold 3 of 5-fold cross-validation        |
| u4.base      | Training set for fold 4 of 5-fold cross-validation    |
| u4.test      | Test set for fold 4 of 5-fold cross-validation        |
| u5.base      | Training set for fold 5 of 5-fold cross-validation    |
| u5.test      | Test set for fold 5 of 5-fold cross-validation        |
| ua.base      | Additional training set split                         |
| ua.test      | Additional test set split                             |
| ub.base      | Another additional training set split                 |
| ub.test      | Another additional test set split                     |

## Training

![mermaid-diagram-2025-03-10-115350](https://github.com/user-attachments/assets/0050d6a9-349f-46fc-8147-43013d7e8498)

## Bayesian Personalized Ranking (BPR) loss

![Screenshot 2025-03-10 at 12 20 07 PM](https://github.com/user-attachments/assets/b03694b3-0a03-4d96-b1b1-51a54e893335)

> source: (He et al., 2020)

## Recall

$Recall@K = \frac{\text{Number of relevant items in top K recommendations}}{\text{Total number of relevant items}}$

<script>
  document.addEventListener("DOMContentLoaded", function() {
    renderMathInElement(document.body, {
      delimiters: [
        {left: '$$', right: '$$', display: true}, // Display math (e.g., equations on their own line)
        {left: '$', right: '$', display: false},  // Inline math (e.g., within a sentence)
        {left: '\\(', right: '\\)', display: false}, // Another way to write inline math
        {left: '\\[', right: '\\]', display: true}   // Another way to write display math
      ]
    });
  });
</script>
